# Terraformμ„ μ‚¬μ©ν• μΈν”„λΌ κµ¬μ¶• λ° κ΄€λ¦¬

<p align="center"><img src="../img/terraform_image.png" alt="terraform introduce" width="800"></p>

---
## μΈμ› λ° κΈ°κ°„
- μΈμ›: 1λ…
  - π™‹β€β™‚ κ³ μ§„ν([KJH0476](https://github.com/KJH0476))
  - ν•΄λ‹Ή ν”„λ΅μ νΈλ” ν•™μµ λ©μ μΌλ΅ κ°μΈμ΄ μ§„ν–‰ν• ν”„λ΅μ νΈμ…λ‹λ‹¤.
- κΈ°κ°„: - `2025.02.07` ~ `2025.03.10`(1λ‹¬)

## λ°°κ²½
ν•΄λ‹Ή ν΄λΌμ°λ“ ν”„λ΅μ νΈλ¥Ό μ§„ν–‰ν•λ©° μ²μ μ¨λ³΄λ” AWS λ¦¬μ†μ¤λ„ λ§κ³ , μƒκ°μΉλ„ λ»ν• μ—λ¬κ°€ λ§μ΄ λ°μƒν•΄μ„ λ¦¬μ†μ¤ μƒμ„± λ° μ‚­μ λ¥Ό λ§μ΄ λ°λ³µν•κ² λμ—μµλ‹λ‹¤.</br>
μ΄λ΅ μΈν•΄, λ¶ν•„μ”ν• λΉ„μ©μ΄ λ§μ΄ λ°μƒν•κ³  μΈν”„λΌλ¥Ό κµ¬μ¶•ν•λ”λ° μ‹κ°„μ΄ λ§μ΄ μ†μ”λμ—μµλ‹λ‹¤. λν•, λ³€κ²½ μ‚¬ν•­μ„ μ¶”μ ν•  μ μ—†μ–΄ λ¶νΈν•¨μ„ λκΌμµλ‹λ‹¤.
μ΄λ¬ν• λ¬Έμ λ¥Ό ν•΄μ†ν•κΈ° μ„ν•΄ Terraformμ„ ν™μ©ν•μ—¬ ν΄λΌμ°λ“ μΈν”„λΌλ¥Ό μ½”λ“λ΅ κ΄€λ¦¬ν•λ” λ°©λ²•μ„ ν•™μµν–μµλ‹λ‹¤. Terraformμ„ μ‚¬μ©ν•¨μΌλ΅μ¨ μΈν”„λΌ κµ¬μ„±μ„ μλ™ν™”ν•κ³ , λ³€κ²½ μ‚¬ν•­μ„ λ²„μ „μΌλ΅ κ΄€λ¦¬ν•μ—¬ μ΄λ ¥μ„ μ‰½κ² μ¶”μ ν•  μ μμΌλ©°, μ΄λ¥Ό ν†µν•΄ ν΄λΌμ°λ“ ν™κ²½μ„ ν¨μ¨μ μ΄κ³  μ•μ •μ μΌλ΅ κµ¬μ¶•ν•κ³ μ ν•μ€μµλ‹λ‹¤.

- **λ³µμ΅ν• μμ΅΄μ„± κ΄€λ¦¬**  
  - μλ¥Ό λ“¤μ–΄, ECS Exec Roleκ³Ό KMS λ¦¬μ†μ¤ μ •μ±…μ€ μ„λ΅μ ARN(κ³ μ  μ‹λ³„μ)μ΄ ν•„μ”ν•©λ‹λ‹¤. μ΄λ¬ν• μƒνΈ μμ΅΄μ„±μ„ μ•μ „ν•κ² κ΄€λ¦¬ν•κΈ° μ„ν•΄ λ¦¬μ†μ¤ μƒμ„± μμ„λ¥Ό λ…ν™•ν ν•΄μ•Ό ν–μµλ‹λ‹¤.

- **ν¨μ¨μ μΈ λ§μ΄ν¬λ΅μ„λΉ„μ¤ λ°°ν¬**  
  - λ§μ΄ν¬λ΅μ„λΉ„μ¤ μ•„ν‚¤ν…μ²μ—μ„λ” μ—¬λ¬ κ°μ ECS Taskμ™€ Serviceλ¥Ό ν• λ²μ— μƒμ„±ν•΄μ•Ό ν•λ” κ²½μ°κ°€ λ§μµλ‹λ‹¤. μ΄λ¥Ό μ„ν•΄ `tpl.json` ν…ν”λ¦Ώ νμΌκ³Ό λ³€μ λ¨λ“ν™”λ¥Ό λ„μ…ν•μ—¬ μ½”λ“ μ¤‘λ³µμ„ μ¤„μ΄κ³  ν™•μ¥μ„±μ„ λ†’μ€μµλ‹λ‹¤.

- **λ¦¬μ „ λ° ν™κ²½λ³„ λ…λ¦½μ„± ν™•λ³΄**  
  - λ¦¬μ „ λ° ν™κ²½λ³„(prod, dev) λ¨λ‘ λ™μΌν• λ¨λ“ κµ¬μ΅°λ¥Ό μ¬μ‚¬μ©ν•λ, λ³€μ μ£Όμ…μ„ ν†µν•΄ κ° ν™κ²½μ— λ§κ² λ…λ¦½μ μΌλ΅ μΈν”„λΌλ¥Ό κµ¬μ„±ν•  μ μλ„λ΅ μ„¤κ³„ν–μµλ‹λ‹¤.

## μ„¤κ³„ λ©ν‘ λ° κ³ λ ¤ μ‚¬ν•­

### 1. λ¨λ“ν™” λ° λ‹¨μΌ μ±…μ„ μ›μΉ™ μ μ©
- **Common λ¨λ“**
    - *μ£Όμ” κµ¬μ„± μ”μ†:* ECS ν΄λ¬μ¤ν„°, ECS Exec Role, ACM, SES
    - ECS Exec Task Roleκ³Ό KMS λ¦¬μ†μ¤ μ •μ±…μ€ μ„λ΅μ ARNμ΄ ν•„μ”ν•λ―€λ΅, Common λ¨λ“μ—μ„ ECS Exec Task Roleμ„ μƒμ„±ν•κ³ , λ‹¤λ¥Έ λ¨λ“μ—μ„ μ΄λ¥Ό μ°Έμ΅°ν•λ„λ΅ μ„¤κ³„ν•μ€μµλ‹λ‹¤.
    - ECS μ‹¤ν–‰ μ—­ν• μ— ν•„μ”ν• μ •μ±…μ€ iam λ¨λ“μ—μ„ λ”°λ΅ κ΄€λ¦¬λλ„λ΅ ν•μ€μµλ‹λ‹¤.

- **μ„λΉ„μ¤λ³„ λ…λ¦½ λ¨λ“**  
  - κ° κΈ°λ¥(IAM, KMS, Route53 λ μ½”λ“, DB, Lambda, ECS, EC2(Bastion), μ›Ή(CloudFront, S3))μ„ λ³„λ„ λ¨λ“λ΅ λ¶„λ¦¬ν•μ—¬ κ΄€λ¦¬ν•¨μΌλ΅μ¨, λ¨λ“ μ—…λ°μ΄νΈ μ‹ λ‹¤λ¥Έ λ¦¬μ†μ¤μ— λ―ΈμΉλ” μν–¥μ„ μµμ†ν™”ν•μ€μµλ‹λ‹¤.

### 2. ν¨μ¨μ μ΄κ³  ν™•μ¥ κ°€λ¥ν• λ§μ΄ν¬λ΅μ„λΉ„μ¤ λ°°ν¬
- **ν…ν”λ¦Ώ κΈ°λ° κµ¬μ„± κ΄€λ¦¬ (`tpl.json`)**  
  -  λ‹¤μμ ECS Taskμ™€ Serviceλ¥Ό λ™μ μΌλ΅ μƒμ„±ν•  ν•„μ”κ°€ μλ” λ§μ΄ν¬λ΅μ„λΉ„μ¤ ν™κ²½μ— λ§μ¶°, ν…ν”λ¦Ώ νμΌκ³Ό λ³€μ μ„¤μ •μ„ ν†µν•΄ κµ¬μ„± μ •λ³΄λ¥Ό λ¨λ“ν™”ν•μ€μµλ‹λ‹¤.

- **λ¦¬μ „λ³„ ν™κ²½λ³„ λ³€μ μ£Όμ…**  
  - λ©€ν‹° λ¦¬μ „ ν™κ²½μ„ μ„ν•΄ λ¨Όμ € λ¦¬μ „λ³„λ΅ κµ¬λ¶„ν• ν›„, λ™μΌν• λ¨λ“ κµ¬μ΅°λ¥Ό ν™μ©ν•μ—¬ κ° λ¦¬μ „μ Prod, Dev λ“± ν™κ²½λ³„ μ”κµ¬μ‚¬ν•­μ— λ§μ¶ λ³€μ μ£Όμ… λ°©μ‹μΌλ΅ μΈν”„λΌλ¥Ό κ°λ³„μ μΌλ΅ μƒμ„±ν•λ„λ΅ μ„¤κ³„ν•μ€μµλ‹λ‹¤.

### 3. μμ΅΄μ„± λ° μ‹¤ν–‰ μμ„ κ΄€λ¦¬
- **μμ„**
  - `route53 (apno2: hosting zone) + network (VPC, Subnet, SG, NAT, RT) + common (ACM, Route53 CNAME, ECS ν΄λ¬μ¤ν„°, ECS Exec Role, ECR, SES)`</br>
    β†’ `kms + database + load_balancer + bastion + web (use1: Cloudfront, S3)`</br>
    β†’ `iam + lambda + ssm`</br>
    β†’ `ecs`

μ„μ μ‹¤ν–‰ μμ„λ¥Ό ν†µν•΄ κΈ°λ° μΈν”„λΌλ¶€ν„° μ• ν”λ¦¬μΌ€μ΄μ… λ μ΄μ–΄κΉμ§€ μ•μ •μ μΌλ΅ κµ¬μ¶•λλ©°, κ° λ‹¨κ³„μ λ¨λ“μ΄ μμ°¨μ μΌλ΅ μ‹¤ν–‰λμ–΄ λ…ν™•ν•κ³  ν¨μ¨μ μΈ κµ¬μ΅°λ¥Ό κ°–μ¶”λ„λ΅ μ„¤κ³„ν•μ€μµλ‹λ‹¤.

## νμΌ κµ¬μ΅°
```shell
.
β”β”€β”€ README.md
β”β”€β”€ _module
β”‚Β Β  β”β”€β”€ bastion
β”‚Β Β  β”‚Β Β  β”β”€β”€ main.tf
β”‚Β Β  β”‚Β Β  β”β”€β”€ outputs.tf
β”‚Β Β  β”‚Β Β  β””β”€β”€ variables.tf
β”‚Β Β  β”β”€β”€ common
β”‚Β Β  β”‚Β Β  β”β”€β”€ main.tf
β”‚Β Β  β”‚Β Β  β”β”€β”€ outputs.tf
β”‚Β Β  β”‚Β Β  β””β”€β”€ variables.tf
β”‚Β Β  β”β”€β”€ database
β”‚Β Β  β”‚Β Β  β”β”€β”€ main.tf
β”‚Β Β  β”‚Β Β  β”β”€β”€ outputs.tf
β”‚Β Β  β”‚Β Β  β””β”€β”€ variables.tf
β”‚Β Β  β”β”€β”€ ecs
β”‚Β Β  β”‚Β Β  β”β”€β”€ main.tf
β”‚Β Β  β”‚Β Β  β”β”€β”€ outputs.tf
β”‚Β Β  β”‚Β Β  β”β”€β”€ task_definition.tpl.json
β”‚Β Β  β”‚Β Β  β””β”€β”€ variables.tf
β”‚Β Β  β”β”€β”€ iam
β”‚Β Β  β”‚Β Β  β”β”€β”€ main.tf
β”‚Β Β  β”‚Β Β  β”β”€β”€ outputs.tf
β”‚Β Β  β”‚Β Β  β””β”€β”€ variables.tf
β”‚Β Β  β”β”€β”€ kms
β”‚Β Β  β”‚Β Β  β”β”€β”€ main.tf
β”‚Β Β  β”‚Β Β  β”β”€β”€ outputs.tf
β”‚Β Β  β”‚Β Β  β””β”€β”€ variables.tf
β”‚Β Β  β”β”€β”€ lambda
β”‚Β Β  β”‚Β Β  β”β”€β”€ main.tf
β”‚Β Β  β”‚Β Β  β”β”€β”€ outputs.tf
β”‚Β Β  β”‚Β Β  β””β”€β”€ variables.tf
β”‚Β Β  β”β”€β”€ lb
β”‚Β Β  β”‚Β Β  β”β”€β”€ main.tf
β”‚Β Β  β”‚Β Β  β”β”€β”€ outputs.tf
β”‚Β Β  β”‚Β Β  β””β”€β”€ variables.tf
β”‚Β Β  β”β”€β”€ network
β”‚Β Β  β”‚Β Β  β”β”€β”€ main.tf
β”‚Β Β  β”‚Β Β  β”β”€β”€ outputs.tf
β”‚Β Β  β”‚Β Β  β””β”€β”€ variables.tf
β”‚Β Β  β”β”€β”€ route53
β”‚Β Β  β”‚Β Β  β”β”€β”€ main.tf
β”‚Β Β  β”‚Β Β  β”β”€β”€ outputs.tf
β”‚Β Β  β”‚Β Β  β””β”€β”€ variables.tf
β”‚Β Β  β”β”€β”€ ssm
β”‚Β Β  β”‚Β Β  β”β”€β”€ main.tf
β”‚Β Β  β”‚Β Β  β”β”€β”€ outputs.tf
β”‚Β Β  β”‚Β Β  β””β”€β”€ variables.tf
β”‚Β Β  β””β”€β”€ web
β”‚Β Β      β”β”€β”€ main.tf
β”‚Β Β      β”β”€β”€ outputs.tf
β”‚Β Β      β””β”€β”€ variables.tf
β”β”€β”€ apnortheast2
β”‚Β Β  β””β”€β”€ env
β”‚Β Β      β”β”€β”€ dev
β”‚Β Β      β”‚Β Β  β”β”€β”€ backend.tf
β”‚Β Β      β”‚Β Β  β”β”€β”€ bastion_ssh_key
β”‚Β Β      β”‚Β Β  β”‚Β Β  β”β”€β”€ dev-apn2-bastion-key
β”‚Β Β      β”‚Β Β  β”‚Β Β  β””β”€β”€ dev-apn2-bastion-key.pub
β”‚Β Β      β”‚Β Β  β”β”€β”€ lambda_functions
β”‚Β Β      β”‚Β Β  β”‚Β Β  β”β”€β”€ lambda_fucntion.py
β”‚Β Β      β”‚Β Β  β”‚Β Β  β””β”€β”€ lambda_function.zip
β”‚Β Β      β”‚Β Β  β”β”€β”€ main.tf
β”‚Β Β      β”‚Β Β  β”β”€β”€ outputs.tf
β”‚Β Β      β”‚Β Β  β”β”€β”€ provider.tf
β”‚Β Β      β”‚Β Β  β”β”€β”€ terraform.tfvars
β”‚Β Β      β”‚Β Β  β””β”€β”€ variables.tf
β”‚Β Β      β””β”€β”€ prod
β”‚Β Β          β”β”€β”€ backend.tf
β”‚Β Β          β”β”€β”€ bastion_ssh_key
β”‚Β Β          β”‚Β Β  β”β”€β”€ prod-apn2-bastion-key
β”‚Β Β          β”‚Β Β  β””β”€β”€ prod-apn2-bastion-key.pub
β”‚Β Β          β”β”€β”€ lambda_functions
β”‚Β Β          β”‚Β Β  β”β”€β”€ lambda_fucntion.py
β”‚Β Β          β”‚Β Β  β””β”€β”€ lambda_function.zip
β”‚Β Β          β”β”€β”€ main.tf
β”‚Β Β          β”β”€β”€ outputs.tf
β”‚Β Β          β”β”€β”€ provider.tf
β”‚Β Β          β”β”€β”€ terraform.tfvars
β”‚Β Β          β””β”€β”€ variables.tf
β”β”€β”€ init
β”‚Β Β  β”β”€β”€ init.tf
β”‚Β Β  β””β”€β”€ terraform.tfstate
β””β”€β”€ useast1
    β””β”€β”€ env
        β”β”€β”€ dev
        β”‚Β Β  β”β”€β”€ backend.tf
        β”‚Β Β  β”β”€β”€ bastion_ssh_key
        β”‚Β Β  β”‚Β Β  β”β”€β”€ dev-use1-bastion-key
        β”‚Β Β  β”‚Β Β  β””β”€β”€ dev-use1-bastion-key.pub
        β”‚Β Β  β”β”€β”€ lambda_functions
        β”‚Β Β  β”‚Β Β  β”β”€β”€ lambda_fucntion.py
        β”‚Β Β  β”‚Β Β  β””β”€β”€ lambda_function.zip
        β”‚Β Β  β”β”€β”€ main.tf
        β”‚Β Β  β”β”€β”€ outputs.tf
        β”‚Β Β  β”β”€β”€ provider.tf
        β”‚Β Β  β”β”€β”€ terraform.tfvars
        β”‚Β Β  β””β”€β”€ variables.tf
        β””β”€β”€ prod
            β”β”€β”€ backend.tf
            β”β”€β”€ bastion_ssh_key
            β”‚Β Β  β”β”€β”€ prod-use1-bastion-key
            β”‚Β Β  β””β”€β”€ prod-use1-bastion-key.pub
            β”β”€β”€ cloudfront_functions
            β”‚Β Β  β””β”€β”€ cloudfront_function.js
            β”β”€β”€ lambda_functions
            β”‚Β Β  β”β”€β”€ lambda_fucntion.py
            β”‚Β Β  β””β”€β”€ lambda_function.zip
            β”β”€β”€ main.tf
            β”β”€β”€ outputs.tf
            β”β”€β”€ provider.tf
            β”β”€β”€ terraform.tfvars
            β””β”€β”€ variables.tf
```
